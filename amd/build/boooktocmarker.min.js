define("block_revisionmanager/boooktocmarker",["jquery","core/ajax"],(function($,Ajax){return{init:function(params){const pageurl=window.location.pathname+window.location.search;Ajax.call([{methodname:"block_revisionmanager_get_read_urls",args:{courseid:params.courseid},done:function(result){const urlRatingsMap={};result.entries.forEach((entry=>{const cleanUrl=entry.pageurl.replace(/^\/+/,"");urlRatingsMap[cleanUrl]=entry.ratingvalues})),$("div.book_toc a").each((function(){const fullpath="mod/book/"+$(this).attr("href");if(urlRatingsMap[fullpath]){const ratingHtml=urlRatingsMap[fullpath].map((rating=>{const clampedRating=Math.max(0,Math.min(5,rating));return'<span class="bg-rating-toc-'.concat(clampedRating,'">').concat(clampedRating,"</span>")})).join("");$(this).prepend(ratingHtml+" ")}})),$("div.book_toc li:has(strong)").each((function(){const $strong=$(this).find("strong");var cleanUrl=pageurl.startsWith("/")?pageurl.substring(1):pageurl;if(cleanUrl.includes("chapterid")||(cleanUrl=cleanUrl+"&chapterid="+params.chapterid),urlRatingsMap[cleanUrl]){const ratingHtml=urlRatingsMap[cleanUrl].map((rating=>{const clampedRating=Math.max(0,Math.min(5,rating));return'<span class="bg-rating-toc-'.concat(clampedRating,'">').concat(clampedRating,"</span>")})).join("");$strong.prepend(ratingHtml+" ")}}))},fail:function(err){window.console.error("Could not fetch read URLs",err)}}])}}}));

//# sourceMappingURL=boooktocmarker.min.js.map